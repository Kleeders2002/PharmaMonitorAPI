services:
  - type: web
    name: pharmamonitor-api
    runtime: python

    buildCommand: pip install --upgrade pip && pip install -r requirements.txt
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT

    # Variables de entorno configuradas automáticamente
    envVars:
      # ============================================================
      # PYTHON VERSION (forzar Python 3.12 en lugar de 3.13)
      # ============================================================
      - key: PYTHON_VERSION
        value: 3.12.0

      # ============================================================
      # DATABASE (Tu base de datos existente en Render)
      # ============================================================
      - key: DATABASE_URL
        value: postgresql://pharmamonitor_user:Q7mLEREmysKkMKpb5xBF4afzhD9a7z8i@dpg-d5vahrili9vc73a3lea0-a.oregon-postgres.render.com/pharmamonitor_db

      # ============================================================
      # JWT SECRET (Render genera un valor seguro automáticamente)
      # ============================================================
      - key: JWT_SECRET
        generateValue: true
        sync: false  # No sobreescribir si se configura manualmente después

      # ============================================================
      # NODEMCU CONFIGURATION (NUEVA ARQUITECTURA)
      # ============================================================
      - key: USE_REAL_SENSORS
        value: true

      - key: SENSOR_STRICT_MODE
        value: true

      # ============================================================
      # ENVIRONMENT
      # ============================================================
      - key: ENVIRONMENT
        value: production

      # ============================================================
      # CORS ORIGINS (IMPORTANTE: Actualizar con tu frontend real)
      # ============================================================
      # Ejemplo para desarrollo (comenta en producción):
      - key: CORS_ORIGINS
        value: http://localhost:3000,http://localhost:19006,http://localhost:8081

      # Ejemplo para producción (descomenta cuando tengas frontend):
      # - key: CORS_ORIGINS
      #   value: https://pharmamonitor-frontend.onrender.com,https://tu-front-end.com

      # ============================================================
      # PORT (Render lo asigna automáticamente)
      # ============================================================
      - key: PORT
        value: 8000
